var UI=function(){this.data={},this.timer,this.timetemp=0,this.db=openDatabase("mydb","1.0","tm_database",2097152),this.paidRatio=25,this.getDate=function(){var t=new Date,e=t.getUTCMonth(),a=t.getUTCDate(),i=t.getUTCFullYear();return i+"-"+e+"-"+a},this.sampleData=function(){this.db.transaction(function(){})},this.displayMainAnalytics=function(t){var e=new Array,a=new Array,i=0;$(".analytics").append('<div class="details"></div>');for(var o in t){var s=new Date(t[o].date),n=s.getMonth()+2;s=s.getDate()+"/"+n+"/"+s.getFullYear(),e[o]=s,a[o]=t[o].time,$(".analytics").append('<div class="date" data-date="'+t[o].date+'"><span class="date_elem">'+s+' </span><span class="time_elem">'+t[o].time+"</span></div>"),i+=t[o].time}var r=Math.round(i/3600*this.paidRatio)+"$";$(".analytics").prepend('<div class="summary">Last month, you earned </strong>'+r+" and you worked "+i+"</div>"),e.reverse(),a.reverse();var c=document.getElementById("chart1").getContext("2d"),a={labels:e,datasets:[{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:a}]},d={bezierCurve:!1};new Chart(c).Line(a,d)},this.getAnalytics=function(){for(var t=this,e=new Date,a=e.getUTCMonth(),i=e.getUTCDate()+1,o=e.getUTCFullYear(),s={},n="",r=0;31>=r;r++){var c=new Date(o,a,i-r),d=c.getUTCMonth(),l=c.getUTCDate(),u=c.getUTCFullYear(),m=u+"-"+d+"-"+l;s[r]={date:m,time:0,nb:0},n+=" date = '"+m+"' OR"}n=n.substring(0,n.length-3),this.db.transaction(function(e){e.executeSql("SELECT * FROM stats WHERE"+n,[],function(e,a){var i=a.rows.length;for(r=0;i>r;r++)for(var o in s)s[o].date==a.rows.item(r).date&&(s[o].time+=a.rows.item(r).time,s[o].nb++);t.displayMainAnalytics(s)})})},this.loadTimersPage=function(t){var e=this;this.getLocalStorage(function(){$.get("page-projects.html",function(a){$(".content").html(a),t(t),$(".ratio").val(e.paidRatio)})})},this.displayDetailsAnalytics=function(t,e){var a="<h2>Details of the day</h2>";for(var i in e)a+="<div class='project_details'>"+e[i].title+" : "+e[i].time+"</div>";$(".details").html(a)},this.loadAnalyticsPage=function(){var t=this;this.getLocalStorage(function(){$.get("page-analytics.html",function(e){$(".content").html(e),t.getAnalytics(),$(document).delegate(".date","click",function(){var e=$(this).attr("data-date");t.db.transaction(function(a){a.executeSql('SELECT * FROM stats WHERE date="'+e+'"',[],function(i,o){var s=o.rows.length,n=new Array;for(d=0;s>d;d++){var r=o.rows.item(d).project_id;void 0==n[r]?n[r]={time:o.rows.item(d).time}:n[r].time+=o.rows.item(d).time}var c=" ";for(var d in n)c+="id = "+d+" OR ";c=c.substring(0,c.length-3),a.executeSql("SELECT * FROM projects WHERE"+c,[],function(a,i){var o=i.rows.length;for(d=0;o>d;d++)n[i.rows.item(d).id].title=i.rows.item(d).title,n[i.rows.item(d).id].created=i.rows.item(d).created,n[i.rows.item(d).id].last=i.rows.item(d).last;t.displayDetailsAnalytics(e,n)})})})})})})},this.init=function(t){var e=this,a=this.getDate();e.getRatio(),this.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS projects (id INTEGER PRIMARY KEY ASC, title TEXT, time INTEGER, created DATE, last DATE)"),t.executeSql("CREATE TABLE IF NOT EXISTS stats (id INTEGER PRIMARY KEY ASC, project_id INTEGER, time INTEGER, date DATE)"),t.executeSql("CREATE TABLE IF NOT EXISTS config (id INTEGER PRIMARY KEY ASC, param TEXT, value TEXT)")}),e.loadTimersPage(t),$(document).delegate("button.start","click",function(){var t=$(this).attr("data-projectid");e.startCounter(t)}),$(document).delegate("button.stop","click",function(){var t=$(this).attr("data-projectid");e.stopCounter(t)}),$(document).delegate("form.addproject","submit",function(){var t=$("form.addproject .title").val();$("form.addproject .title").val("");var i={title:t,time:0,created:a,last:a},o=0;for(var s in e.data)o++;return e.data[o+1]=i,e.setLocalStorage(function(){e.showProjects()}),!1}),$(document).delegate("form.ratioh","submit",function(){var t=$("form.ratioh .ratio").val();return e.updateRatio(t),!1}),$(".sidebar ul li").on("click",function(){var a=$(this).attr("data-link");$(".sidebar ul li").removeClass("active"),$(this).addClass("active"),"timers"==a?e.loadTimersPage(t):"analytics"==a&&e.loadAnalyticsPage()})},this.setTimeToSQL=function(t,e){var a=this;this.db.transaction(function(i){i.executeSql("UPDATE projects SET time = "+e+', last = "'+a.getDate()+'" WHERE id = '+t)})},this.setLocalStorage=function(t){var e=this;this.db.transaction(function(a){for(var i in e.data)a.executeSql('SELECT * FROM projects WHERE title = "'+e.data[i].title+'"',[],function(o,s){var n=s.rows.length;0>=n&&a.executeSql('INSERT INTO projects (id, title, time, created, last) VALUES (null, "'+e.data[i].title+'", "'+e.data[i].time+'", "'+e.data[i].created+'", "'+e.data[i].last+'")'),t()})})},this.updateRatio=function(t){var e=this;this.db.transaction(function(a){a.executeSql('SELECT * FROM config WHERE param = "ratio"',[],function(i,o){var s=o.rows.length;console.log(s),a.executeSql(0>=s?'INSERT INTO config (id, param, value) VALUES (null, "ratio", "'+t+'")':'UPDATE config SET value = "'+t+'" WHERE param = "ratio"'),e.getRatio()})})},this.getRatio=function(){var t=this;this.db.transaction(function(e){e.executeSql('SELECT * FROM config WHERE param = "ratio"',[],function(e,a){var i=a.rows.length;0!=i&&(t.paidRatio=a.rows.item(0).value,$(".ratio").val(t.paidRatio))})})},this.setDataToLocal=function(t,e){this.data=t,e()},this.getLocalStorage=function(t){var e=this,a=new Array;this.db.transaction(function(i){i.executeSql("SELECT * FROM projects",[],function(i,o){var s,n=o.rows.length;for(s=0;n>s;s++)a[o.rows.item(s).id]={title:o.rows.item(s).title,time:o.rows.item(s).time,created:o.rows.item(s).created,last:o.rows.item(s).last};e.setDataToLocal(a,t)})})},this.startCounter=function(t){var e=this;window.clearInterval(this.timer),$("button.stop").text("START").removeClass("stop").addClass("start"),$(".project-"+t).find("button.start").text("STOP").removeClass("start").addClass("stop"),e.timetemp=e.data[t].time,this.timer=window.setInterval(function(){e.data[t].time++,e.updateTimes(),e.setTimeToSQL(t,e.data[t].time)},1e3)},this.stopCounter=function(t){var e=this;$(".project-"+t).find("button.stop").text("START").removeClass("stop").addClass("start");var a=this.getDate(),i=e.data[t].time-e.timetemp;this.db.transaction(function(e){e.executeSql('INSERT INTO stats (id, project_id, time, date) VALUES (null, "'+t+'", "'+i+'", "'+a+'")')}),window.clearInterval(this.timer),e.updateTimes()},this.getProjects=function(t){t()},this.showProjects=function(){$(".projects").html("");for(var t in this.data)$(".projects").append('<div class="project project-'+t+'" data-projectid="'+t+'"><h2>'+this.data[t].title+'</h2><p class="time">'+this.data[t].time+'</p><button data-projectid="'+t+'" class="start">START</button></div>')},this.updateTimes=function(){var t=this;$(".project").each(function(){var e=$(this).attr("data-projectid");$(this).find(".time").text(t.data[e].time)})}},main=new UI;main.init(function(){main.showProjects()});(t.data[e].time)})}},main=new UI;main.init(function(){main.showProjects()});tionSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var l=a?i(r.Line.defaults,a):r.Line.defaults;return new g(t,l,e)},this.Bar=function(t,a){r.Bar.defaults={scaleOverlay:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var l=a?i(r.Bar.defaults,a):r.Bar.defaults;return new b(t,l,e)};var u=function(e,o,i){var s,r,c,u,S,f,p,g,b;for(S=Math.min.apply(Math,[h,d])/2,S-=Math.max.apply(Math,[.5*o.scaleFontSize,.5*o.scaleLineWidth]),u=2*o.scaleFontSize,o.scaleShowLabelBackdrop&&(u+=2*o.scaleBackdropPaddingY,S-=1.5*o.scaleBackdropPaddingY),g=S,u=u?u:5,s=Number.MIN_VALUE,r=Number.MAX_VALUE,c=0;c<e.length;c++)e[c].value>s&&(s=e[c].value),e[c].value<r&&(r=e[c].value);c=Math.floor(g/(.66*u)),u=Math.floor(.5*(g/u)),b=o.scaleShowLabels?o.scaleLabel:null,o.scaleOverride?(p={steps:o.scaleSteps,stepValue:o.scaleStepWidth,graphMin:o.scaleStartValue,labels:[]},n(b,p.labels,p.steps,o.scaleStartValue,o.scaleStepWidth)):p=l(g,c,u,s,r,b),f=S/p.steps,a(o,function(){for(var e=0;e<p.steps;e++)if(o.scaleShowLine&&(i.beginPath(),i.arc(h/2,d/2,f*(e+1),0,2*Math.PI,!0),i.strokeStyle=o.scaleLineColor,i.lineWidth=o.scaleLineWidth,i.stroke()),o.scaleShowLabels){i.textAlign="center",i.font=o.scaleFontStyle+" "+o.scaleFontSize+"px "+o.scaleFontFamily;var t=p.labels[e];if(o.scaleShowLabelBackdrop){var a=i.measureText(t).width;i.fillStyle=o.scaleBackdropColor,i.beginPath(),i.rect(Math.round(h/2-a/2-o.scaleBackdropPaddingX),Math.round(d/2-f*(e+1)-.5*o.scaleFontSize-o.scaleBackdropPaddingY),Math.round(a+2*o.scaleBackdropPaddingX),Math.round(o.scaleFontSize+2*o.scaleBackdropPaddingY)),i.fill()}i.textBaseline="middle",i.fillStyle=o.scaleFontColor,i.fillText(t,h/2,d/2-f*(e+1))}},function(a){var l=-Math.PI/2,n=2*Math.PI/e.length,s=1,r=1;for(o.animation&&(o.animateScale&&(s=a),o.animateRotate&&(r=a)),a=0;a<e.length;a++)i.beginPath(),i.arc(h/2,d/2,s*t(e[a].value,p,f),l,l+r*n,!1),i.lineTo(h/2,d/2),i.closePath(),i.fillStyle=e[a].color,i.fill(),o.segmentShowStroke&&(i.strokeStyle=o.segmentStrokeColor,i.lineWidth=o.segmentStrokeWidth,i.stroke()),l+=r*n},i)},S=function(e,i,s){var r,c,u,S,f,p,g,b,m;for(e.labels||(e.labels=[]),f=Math.min.apply(Math,[h,d])/2,S=2*i.scaleFontSize,r=b=0;r<e.labels.length;r++)s.font=i.pointLabelFontStyle+" "+i.pointLabelFontSize+"px "+i.pointLabelFontFamily,c=s.measureText(e.labels[r]).width,c>b&&(b=c);for(f-=Math.max.apply(Math,[b,1.5*(i.pointLabelFontSize/2)]),f-=i.pointLabelFontSize,b=f=o(f,null,0),S=S?S:5,r=Number.MIN_VALUE,c=Number.MAX_VALUE,u=0;u<e.datasets.length;u++)for(m=0;m<e.datasets[u].data.length;m++)e.datasets[u].data[m]>r&&(r=e.datasets[u].data[m]),e.datasets[u].data[m]<c&&(c=e.datasets[u].data[m]);u=Math.floor(b/(.66*S)),S=Math.floor(.5*(b/S)),m=i.scaleShowLabels?i.scaleLabel:null,i.scaleOverride?(g={steps:i.scaleSteps,stepValue:i.scaleStepWidth,graphMin:i.scaleStartValue,labels:[]},n(m,g.labels,g.steps,i.scaleStartValue,i.scaleStepWidth)):g=l(b,u,S,r,c,m),p=f/g.steps,a(i,function(){var t=2*Math.PI/e.datasets[0].data.length;if(s.save(),s.translate(h/2,d/2),i.angleShowLineOut){s.strokeStyle=i.angleLineColor,s.lineWidth=i.angleLineWidth;for(var a=0;a<e.datasets[0].data.length;a++)s.rotate(t),s.beginPath(),s.moveTo(0,0),s.lineTo(0,-f),s.stroke()}for(a=0;a<g.steps;a++){if(s.beginPath(),i.scaleShowLine){s.strokeStyle=i.scaleLineColor,s.lineWidth=i.scaleLineWidth,s.moveTo(0,-p*(a+1));for(var l=0;l<e.datasets[0].data.length;l++)s.rotate(t),s.lineTo(0,-p*(a+1));s.closePath(),s.stroke()}i.scaleShowLabels&&(s.textAlign="center",s.font=i.scaleFontStyle+" "+i.scaleFontSize+"px "+i.scaleFontFamily,s.textBaseline="middle",i.scaleShowLabelBackdrop&&(l=s.measureText(g.labels[a]).width,s.fillStyle=i.scaleBackdropColor,s.beginPath(),s.rect(Math.round(-l/2-i.scaleBackdropPaddingX),Math.round(-p*(a+1)-.5*i.scaleFontSize-i.scaleBackdropPaddingY),Math.round(l+2*i.scaleBackdropPaddingX),Math.round(i.scaleFontSize+2*i.scaleBackdropPaddingY)),s.fill()),s.fillStyle=i.scaleFontColor,s.fillText(g.labels[a],0,-p*(a+1)))}for(a=0;a<e.labels.length;a++){s.font=i.pointLabelFontStyle+" "+i.pointLabelFontSize+"px "+i.pointLabelFontFamily,s.fillStyle=i.pointLabelFontColor;var l=Math.sin(t*a)*(f+i.pointLabelFontSize),n=Math.cos(t*a)*(f+i.pointLabelFontSize);s.textAlign=t*a==Math.PI||0==t*a?"center":t*a>Math.PI?"right":"left",s.textBaseline="middle",s.fillText(e.labels[a],l,-n)}s.restore()},function(a){var l=2*Math.PI/e.datasets[0].data.length;s.save(),s.translate(h/2,d/2);for(var n=0;n<e.datasets.length;n++){s.beginPath(),s.moveTo(0,-1*a*t(e.datasets[n].data[0],g,p));for(var o=1;o<e.datasets[n].data.length;o++)s.rotate(l),s.lineTo(0,-1*a*t(e.datasets[n].data[o],g,p));if(s.closePath(),s.fillStyle=e.datasets[n].fillColor,s.strokeStyle=e.datasets[n].strokeColor,s.lineWidth=i.datasetStrokeWidth,s.fill(),s.stroke(),i.pointDot)for(s.fillStyle=e.datasets[n].pointColor,s.strokeStyle=e.datasets[n].pointStrokeColor,s.lineWidth=i.pointDotStrokeWidth,o=0;o<e.datasets[n].data.length;o++)s.rotate(l),s.beginPath(),s.arc(0,-1*a*t(e.datasets[n].data[o],g,p),i.pointDotRadius,2*Math.PI,!1),s.fill(),s.stroke();s.rotate(l)}s.restore()},s)},f=function(e,t,l){for(var n=0,o=Math.min.apply(Math,[d/2,h/2])-5,i=0;i<e.length;i++)n+=e[i].value;a(t,null,function(a){var i=-Math.PI/2,s=1,r=1;for(t.animation&&(t.animateScale&&(s=a),t.animateRotate&&(r=a)),a=0;a<e.length;a++){var c=r*e[a].value/n*2*Math.PI;l.beginPath(),l.arc(h/2,d/2,s*o,i,i+c),l.lineTo(h/2,d/2),l.closePath(),l.fillStyle=e[a].color,l.fill(),t.segmentShowStroke&&(l.lineWidth=t.segmentStrokeWidth,l.strokeStyle=t.segmentStrokeColor,l.stroke()),i+=c}},l)},p=function(e,t,l){for(var n=0,o=Math.min.apply(Math,[d/2,h/2])-5,i=o*(t.percentageInnerCutout/100),s=0;s<e.length;s++)n+=e[s].value;a(t,null,function(a){var s=-Math.PI/2,r=1,c=1;for(t.animation&&(t.animateScale&&(r=a),t.animateRotate&&(c=a)),a=0;a<e.length;a++){var u=c*e[a].value/n*2*Math.PI;l.beginPath(),l.arc(h/2,d/2,r*o,s,s+u,!1),l.arc(h/2,d/2,r*i,s+u,s,!0),l.closePath(),l.fillStyle=e[a].color,l.fill(),t.segmentShowStroke&&(l.lineWidth=t.segmentStrokeWidth,l.strokeStyle=t.segmentStrokeColor,l.stroke()),s+=u}},l)},g=function(e,o,i){var s,r,c,u,S,f,p,g,b,m,M,v,k,L=0;for(S=d,i.font=o.scaleFontStyle+" "+o.scaleFontSize+"px "+o.scaleFontFamily,m=1,u=0;u<e.labels.length;u++)s=i.measureText(e.labels[u]).width,m=s>m?s:m;for(h/e.labels.length<m?(L=45,h/e.labels.length<Math.cos(L)*m?(L=90,S-=m):S-=Math.sin(L)*m):S-=o.scaleFontSize,u=o.scaleFontSize,S=S-5-u,s=Number.MIN_VALUE,r=Number.MAX_VALUE,c=0;c<e.datasets.length;c++)for(g=0;g<e.datasets[c].data.length;g++)e.datasets[c].data[g]>s&&(s=e.datasets[c].data[g]),e.datasets[c].data[g]<r&&(r=e.datasets[c].data[g]);if(c=Math.floor(S/(.66*u)),u=Math.floor(.5*(S/u)),g=o.scaleShowLabels?o.scaleLabel:"",o.scaleOverride?(p={steps:o.scaleSteps,stepValue:o.scaleStepWidth,graphMin:o.scaleStartValue,labels:[]},n(g,p.labels,p.steps,o.scaleStartValue,o.scaleStepWidth)):p=l(S,c,u,s,r,g),f=Math.floor(S/p.steps),u=1,o.scaleShowLabels){for(i.font=o.scaleFontStyle+" "+o.scaleFontSize+"px "+o.scaleFontFamily,s=0;s<p.labels.length;s++)r=i.measureText(p.labels[s]).width,u=r>u?r:u;u+=10}M=h-u-m,b=Math.floor(M/(e.labels.length-1)),v=h-m/2-M,k=S+o.scaleFontSize/2,a(o,function(){i.lineWidth=o.scaleLineWidth,i.strokeStyle=o.scaleLineColor,i.beginPath(),i.moveTo(h-m/2+5,k),i.lineTo(h-m/2-M-5,k),i.stroke(),L>0?(i.save(),i.textAlign="right"):i.textAlign="center",i.fillStyle=o.scaleFontColor;for(var t=0;t<e.labels.length;t++)i.save(),L>0?(i.translate(v+t*b,k+o.scaleFontSize),i.rotate(-(L*(Math.PI/180))),i.fillText(e.labels[t],0,0),i.restore()):i.fillText(e.labels[t],v+t*b,k+o.scaleFontSize+3),i.beginPath(),i.moveTo(v+t*b,k+3),o.scaleShowGridLines&&t>0?(i.lineWidth=o.scaleGridLineWidth,i.strokeStyle=o.scaleGridLineColor,i.lineTo(v+t*b,5)):i.lineTo(v+t*b,k+3),i.stroke();for(i.lineWidth=o.scaleLineWidth,i.strokeStyle=o.scaleLineColor,i.beginPath(),i.moveTo(v,k+5),i.lineTo(v,5),i.stroke(),i.textAlign="right",i.textBaseline="middle",t=0;t<p.steps;t++)i.beginPath(),i.moveTo(v-3,k-(t+1)*f),o.scaleShowGridLines?(i.lineWidth=o.scaleGridLineWidth,i.strokeStyle=o.scaleGridLineColor,i.lineTo(v+M+5,k-(t+1)*f)):i.lineTo(v-.5,k-(t+1)*f),i.stroke(),o.scaleShowLabels&&i.fillText(p.labels[t],v-8,k-(t+1)*f)},function(a){function l(l,n){return k-a*t(e.datasets[l].data[n],p,f)}for(var n=0;n<e.datasets.length;n++){i.strokeStyle=e.datasets[n].strokeColor,i.lineWidth=o.datasetStrokeWidth,i.beginPath(),i.moveTo(v,k-a*t(e.datasets[n].data[0],p,f));for(var s=1;s<e.datasets[n].data.length;s++)o.bezierCurve?i.bezierCurveTo(v+b*(s-.5),l(n,s-1),v+b*(s-.5),l(n,s),v+b*s,l(n,s)):i.lineTo(v+b*s,l(n,s));if(i.stroke(),o.datasetFill?(i.lineTo(v+b*(e.datasets[n].data.length-1),k),i.lineTo(v,k),i.closePath(),i.fillStyle=e.datasets[n].fillColor,i.fill()):i.closePath(),o.pointDot)for(i.fillStyle=e.datasets[n].pointColor,i.strokeStyle=e.datasets[n].pointStrokeColor,i.lineWidth=o.pointDotStrokeWidth,s=0;s<e.datasets[n].data.length;s++)i.beginPath(),i.arc(v+b*s,k-a*t(e.datasets[n].data[s],p,f),o.pointDotRadius,0,2*Math.PI,!0),i.fill(),i.stroke()}},i)},b=function(e,o,i){var s,r,c,u,S,f,p,g,b,m,M,v,k,L,F=0;for(S=d,i.font=o.scaleFontStyle+" "+o.scaleFontSize+"px "+o.scaleFontFamily,m=1,u=0;u<e.labels.length;u++)s=i.measureText(e.labels[u]).width,m=s>m?s:m;for(h/e.labels.length<m?(F=45,h/e.labels.length<Math.cos(F)*m?(F=90,S-=m):S-=Math.sin(F)*m):S-=o.scaleFontSize,u=o.scaleFontSize,S=S-5-u,s=Number.MIN_VALUE,r=Number.MAX_VALUE,c=0;c<e.datasets.length;c++)for(g=0;g<e.datasets[c].data.length;g++)e.datasets[c].data[g]>s&&(s=e.datasets[c].data[g]),e.datasets[c].data[g]<r&&(r=e.datasets[c].data[g]);if(c=Math.floor(S/(.66*u)),u=Math.floor(.5*(S/u)),g=o.scaleShowLabels?o.scaleLabel:"",o.scaleOverride?(p={steps:o.scaleSteps,stepValue:o.scaleStepWidth,graphMin:o.scaleStartValue,labels:[]},n(g,p.labels,p.steps,o.scaleStartValue,o.scaleStepWidth)):p=l(S,c,u,s,r,g),f=Math.floor(S/p.steps),u=1,o.scaleShowLabels){for(i.font=o.scaleFontStyle+" "+o.scaleFontSize+"px "+o.scaleFontFamily,s=0;s<p.labels.length;s++)r=i.measureText(p.labels[s]).width,u=r>u?r:u;u+=10}M=h-u-m,b=Math.floor(M/e.labels.length),L=(b-2*o.scaleGridLineWidth-2*o.barValueSpacing-(o.barDatasetSpacing*e.datasets.length-1)-(o.barStrokeWidth/2*e.datasets.length-1))/e.datasets.length,v=h-m/2-M,k=S+o.scaleFontSize/2,a(o,function(){i.lineWidth=o.scaleLineWidth,i.strokeStyle=o.scaleLineColor,i.beginPath(),i.moveTo(h-m/2+5,k),i.lineTo(h-m/2-M-5,k),i.stroke(),F>0?(i.save(),i.textAlign="right"):i.textAlign="center",i.fillStyle=o.scaleFontColor;for(var t=0;t<e.labels.length;t++)i.save(),F>0?(i.translate(v+t*b,k+o.scaleFontSize),i.rotate(-(F*(Math.PI/180))),i.fillText(e.labels[t],0,0),i.restore()):i.fillText(e.labels[t],v+t*b+b/2,k+o.scaleFontSize+3),i.beginPath(),i.moveTo(v+(t+1)*b,k+3),i.lineWidth=o.scaleGridLineWidth,i.strokeStyle=o.scaleGridLineColor,i.lineTo(v+(t+1)*b,5),i.stroke();for(i.lineWidth=o.scaleLineWidth,i.strokeStyle=o.scaleLineColor,i.beginPath(),i.moveTo(v,k+5),i.lineTo(v,5),i.stroke(),i.textAlign="right",i.textBaseline="middle",t=0;t<p.steps;t++)i.beginPath(),i.moveTo(v-3,k-(t+1)*f),o.scaleShowGridLines?(i.lineWidth=o.scaleGridLineWidth,i.strokeStyle=o.scaleGridLineColor,i.lineTo(v+M+5,k-(t+1)*f)):i.lineTo(v-.5,k-(t+1)*f),i.stroke(),o.scaleShowLabels&&i.fillText(p.labels[t],v-8,k-(t+1)*f)},function(a){i.lineWidth=o.barStrokeWidth;for(var l=0;l<e.datasets.length;l++){i.fillStyle=e.datasets[l].fillColor,i.strokeStyle=e.datasets[l].strokeColor;for(var n=0;n<e.datasets[l].data.length;n++){var s=v+o.barValueSpacing+b*n+L*l+o.barDatasetSpacing*l+o.barStrokeWidth*l;i.beginPath(),i.moveTo(s,k),i.lineTo(s,k-a*t(e.datasets[l].data[n],p,f)+o.barStrokeWidth/2),i.lineTo(s+L,k-a*t(e.datasets[l].data[n],p,f)+o.barStrokeWidth/2),i.lineTo(s+L,k),o.barShowStroke&&i.stroke(),i.closePath(),i.fill()}}},i)},m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},M={}};